---
title:  ê°œì¸ í”„ë¡œì íŠ¸ MSA ì „í™˜ - (2) ë©€í‹° ëª¨ë“ˆ êµ¬ì„±
date: 2025-02-26 23:30:00 +09:00
categories: [Spring, MSA]
tags:
  [
    java,
    Spring,
    ìŠ¤í”„ë§,
    MSA,
    MicroService,
    ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
  ]
---

* * *

ê¸°ì¡´ ì œ í”„ë¡œì íŠ¸ëŠ” ë‹¨ì¼ëª¨ë“ˆë¡œ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³  ì´ë¥¼ ë©€í‹°ëª¨ë“ˆë¡œ êµ¬ì„±í•˜ì—¬ MSAë¡œ ì „í™˜í•´ë³´ê² ìŠµë‹ˆë‹¤.

## âœ… ë©€í‹° ëª¨ë“ˆ ì´ë€?
* ë©€í‹° ëª¨ë“ˆì€ ì—¬ëŸ¬ ê°œì˜ ëª¨ë“ˆì„ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
* ì—¬ëŸ¬ ê°œì˜ ëª¨ë“ˆì„ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¡œ ê´€ë¦¬í•˜ë©´, ê° ëª¨ë“ˆì„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¦‰, MSA êµ¬ì¡°ì—ì„œëŠ” ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ì˜ ëª¨ë“ˆë¡œ ê´€ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.       
ì´ë¥¼ ìœ„í•´ ê¸°ì¡´ì˜ ë‹¨ì¼ ëª¨ë“ˆ êµ¬ì¡°ì—ì„œ ë©€í‹° ëª¨ë“ˆ êµ¬ì¡°ë¡œ ë³€ê²½í•´ë³´ê² ìŠµë‹ˆë‹¤.

<br> 

### ğŸ“Œ ë©€í‹°ëª¨ë“ˆ ë‹¨ì¼ í”„ë¡œì íŠ¸
ëª¨ë“  ëª¨ë“ˆì„ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´, Gradle ë˜ëŠ” Mavenì„ ê¸°ì¤€ìœ¼ë¡œ `ë£¨íŠ¸ í”„ë¡œì íŠ¸`ê°€ ì¡´ì¬í•˜ê³  ê·¸ í•˜ìœ„ì— ì—¬ëŸ¬ `ì„œë¸Œ ëª¨ë“ˆ`ì´ ì¡´ì¬í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤

#### ğŸ›  êµ¬ì¡° ì˜ˆì‹œ

```scss
root
â”œâ”€â”€ build.gradle       
â”œâ”€â”€ settings.gradle
â”œâ”€â”€ module-a (project starter module)
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
|â”€â”€ â””â”€â”€ StartApplication.java
â”œâ”€â”€ module-b
â”‚   â”œâ”€â”€ build.gradle 
â”‚   â””â”€â”€ src
â””â”€â”€ module-c
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
```

ìœ„ì™€ ê°™ì€ êµ¬ì¡°ëŠ” ê²°êµ­ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¡œ ê´€ë¦¬ë˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—, ëª¨ë“  ëª¨ë“ˆì´ í•˜ë‚˜ì˜ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.    
ì¦‰ ì ì§„ì ìœ¼ë¡œ MSAë¡œ ì „í™˜ì‹œ ì„ì‹œ êµ¬ì¡°ë¡œëŠ” ì í•©í•˜ì§€ë§Œ, ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.

<br> 

### ğŸ“Œ ë©€í‹°ëª¨ë“ˆ ë©€í‹° í”„ë¡œì íŠ¸
* ì—¬ëŸ¬ ê°œì˜ í”„ë¡œì íŠ¸ë¡œ ë‚˜ëˆ„ì–´ ê° í”„ë¡œì íŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.  
* ê° í”„ë¡œì íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ë¹Œë“œí•˜ê³  ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  


#### ğŸ›  êµ¬ì¡° ì˜ˆì‹œ

```scss
root
â”œâ”€â”€ build.gradle
â”œâ”€â”€ settings.gradle
â”œâ”€â”€ module-a
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java
â”œâ”€â”€ module-b
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java
â”œâ”€â”€ module-c
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java

```

ê° ëª¨ë“ˆì´ ë…ë¦½ì ì¸ í”„ë¡œì íŠ¸ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ê°€ ë˜ì–´ ìˆì–´, ê°ê° ë³„ë„ì˜ ë¹Œë“œ/ë°°í¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.  

<br> 
<br> 


## âœ… ë©€í‹° ëª¨ë“ˆ êµ¬ì„±í•˜ê¸°

ìµœì¢…ì ìœ¼ë¡œ êµ¬ì„±í•  ë©€í‹° ëª¨ë“ˆì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```scss
root
â”œâ”€â”€ build.gradle
â”œâ”€â”€ settings.gradle
â”œâ”€â”€ account-book-service
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java
â”œâ”€â”€ user-service
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java
â”œâ”€â”€ common
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ StartApplication.java
```

* `account-book-service` : ê°€ê³„ë¶€ ê´€ë ¨ ì„œë¹„ìŠ¤
* `user-service` : ì‚¬ìš©ì ê´€ë ¨ ì •ë³´ ì„œë¹„ìŠ¤
* `common` : ê³µí†µ ëª¨ë“ˆ

1ì°¨ì ìœ¼ë¡œëŠ” ìœ„ì™€ ê°™ì´ 3ê°œì˜ ëª¨ë“ˆë¡œ ë‚˜ëˆ„ê³   
ìµœì¢…ì ìœ¼ë¡œëŠ”
`api-gateway`, `discovery-server`, `config-server` ë“±ì˜ ëª¨ë“ˆì„ ì¶”ê°€í•  ì˜ˆì •ì…ë‹ˆë‹¤.

<br> 


### ğŸ“Œ í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°

![img_3.png](..%2F..%2F..%2Fassets%2Fimg%2FSpring%2Fimg_3.png)

í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ìœ„ì™€ ê°™ì´ ë‹¨ì¼ ëª¨ë“ˆë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
`domain`, `global` íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

<br>

### ğŸ“Œ ìµœì¢… í”„ë¡œì íŠ¸ êµ¬ì¡°
![img.png](../../../assets/img/Spring/img6.png)

1. `account-book-service`
* accountbook íŒ¨í‚¤ì§€
* budget íŒ¨í‚¤ì§€
* category íŒ¨í‚¤ì§€

2. `user-service`
* user íŒ¨í‚¤ì§€

3. `moneyminder-common`
* global íŒ¨í‚¤ì§€
* domain.auth íŒ¨í‚¤ì§€

í–¥í›„ `api-gateway`, `discovery-server`, `config-server` ë“±ì˜ ëª¨ë“ˆì„ ì¶”ê°€í•  ì˜ˆì •ì´ë¯€ë¡œ auth íŒ¨í‚¤ì§€ëŠ” api-gatewayë¡œ ì´ë™í•  ì˜ˆì •ì…ë‹ˆë‹¤.


### ğŸ“Œ Root ëª¨ë“ˆ êµ¬ì„±

ì´ì œ Root ëª¨ë“ˆì—ì„œëŠ” `ê° ëª¨ë“ˆì„ ê´€ë¦¬í•˜ëŠ” ì—­í• `ë§Œ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.  
ì´ë¥¼ ìœ„í•´ `settings.gradle`ê³¼ `build.gradle`ì„ ì„¤ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.

<br>

#### ğŸ›  settings.gradle
```groovy
rootProject.name = 'MoneyMinder'

// build.gradleì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë§Œ í¬í•¨
file(rootDir).eachDir { dir ->
  if (new File(dir, 'build.gradle.kts').exists() || new File(dir, 'build.gradle').exists()) {
    include dir.name
  }
}

```

* `rootProject.name`: Root í”„ë¡œì íŠ¸ì˜ ì´ë¦„
* `file(rootDir).eachDir`: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ ëª¨ë“  ì„œë¸Œí´ë”ë¥¼ ìë™ìœ¼ë¡œ ëª¨ë“ˆë¡œ ë“±ë¡
  * `new File(dir, 'build.gradle').exists()`: ì„œë¸Œí´ë” ë‚´ì— `build.gradle` íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° í•´ë‹¹ ëª¨ë“ˆë¡œ ë“±ë¡

<br>

#### ğŸ›  build.gradle (Root)
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.3.0'
    id 'io.spring.dependency-management' version '1.1.5'
}

group = 'com.moneyminder'
version = '0.0.1'

repositories {
    mavenCentral()
}


// ëª¨ë“  ì„œë¸Œí”„ë¡œì íŠ¸ ê³µí†µ ì„¤ì •
subprojects {

    apply plugin: 'java'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    group = rootProject.group
    version = rootProject.version
    sourceCompatibility = '17'

    repositories {
        mavenCentral()
    }

    dependencyManagement {
        imports {
            mavenBom "org.springframework.boot:spring-boot-dependencies:3.3.0"
        }
    }
}

bootJar {
    enabled = false
}
jar {
    enabled = true
}

project(':user-service') {
    dependencies {
        implementation project(':moneyminder-common')
    }
}

project(':account-book-service') {
    dependencies {
        implementation project(':moneyminder-common')
    }
}
```

* `BootJar` & `Jar` ì„¤ì •
  * `BootJar`: Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ ê°€ëŠ¥í•œ JAR íŒŒì¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸
  * `Jar`: JAR íŒŒì¼ì„ ë§Œë“¤ì–´ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸
  * `enabled`: JAR íŒŒì¼ ìƒì„± ì—¬ë¶€  
   ì¦‰, `Jar`ë§Œ í™œì„±í™”ì‹œí‚¤ë©´ ì‹¤í–‰ë˜ëŠ” jaríŒŒì¼ì´ ì•„ë‹Œ, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—­í• ì˜ jaríŒŒì¼ì„ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.


* `subprojects`
  * ëª¨ë“  ì„œë¸Œí”„ë¡œì íŠ¸ì— ê³µí†µìœ¼ë¡œ ì ìš©í•  ì„¤ì •
  * `sourceCompatibility`: Java ë²„ì „ ì„¤ì •
  * `repositories`: Maven Central Repository ì¶”ê°€
  * `dependencyManagement`: ì˜ì¡´ì„± ê´€ë¦¬ ì„¤ì •


* `project(':user-service')`, `project(':account-book-service')`
  * `user-service`, `account-book-service` ëª¨ë“ˆì—ì„œ `moneyminder-common` ëª¨ë“ˆì„ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •

<br>

#### ğŸ›  build.gradle (user-service, account-book-service)
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot'
    id 'application'
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.h2database:h2'
}

application {
    mainClass = 'com.moneyminder.UserApplication'
}

bootJar {
    mainClass = 'com.moneyminder.UserApplication'
}

```

ê° ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„± ë° ì„¤ì •ì„ ë³„ë„ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

* `application`
  * `mainClass`: ì‹¤í–‰í•  ë©”ì¸ í´ë˜ìŠ¤ ì§€ì •

<br>

#### ğŸ›  build.gradle (moneyminder-common)
```groovy
configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

dependencies {
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    implementation 'org.springframework.boot:spring-boot-starter'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-web'

    // oauth2
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'

    //jwt
    implementation 'io.jsonwebtoken:jjwt-api:0.11.2'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.2'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.2'

    //ë¡œê·¸ ì¶œë ¥ p6spy
    implementation 'p6spy:p6spy:3.9.1'
    implementation 'com.github.gavlyukovskiy:datasource-decorator-spring-boot-autoconfigure:1.9.0'

    // lombok
    annotationProcessor 'org.projectlombok:lombok'
    compileOnly 'org.projectlombok:lombok'

    // validation
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // QueryDSL
    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor "com.querydsl:querydsl-apt:5.0.0:jakarta"
    annotationProcessor "jakarta.annotation:jakarta.annotation-api"
    annotationProcessor "jakarta.persistence:jakarta.persistence-api"

    // guava
    implementation 'com.google.guava:guava:32.1.2-jre'

    // actuator && prometheus
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    runtimeOnly "io.micrometer:micrometer-registry-prometheus"

    // commons-lang3
    implementation group: 'org.apache.commons', name: 'commons-lang3', version: '3.12.0'
    // ë©”ì¼ ì „ì†¡ ë¼ì´ë¸ŒëŸ¬ë¦¬
    implementation 'org.springframework.boot:spring-boot-starter-mail'

    // redis
    implementation 'org.springframework.boot:spring-boot-starter-data-redis'

    // embedded-redis
    compileOnly group: 'it.ozimov', name: 'embedded-redis', version: '0.7.2'
    testImplementation group: 'it.ozimov', name: 'embedded-redis', version: '0.7.2'

    // slack
    implementation "net.gpedro.integrations.slack:slack-webhook:1.4.0"


    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    runtimeOnly 'com.h2database:h2'
    runtimeOnly 'com.mysql:mysql-connector-j'

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'io.rest-assured:rest-assured:5.3.0'

    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

}


def querydslSrcDir = 'src/main/generated'
clean {
    delete file(querydslSrcDir)
}

tasks.withType(JavaCompile).configureEach {
    options.generatedSourceOutputDirectory = file(querydslSrcDir)
}
```

ì•„ì§ ê° ëª¨ë“ˆë³„ë¡œ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶„ë¦¬í•˜ëŠ” ì‘ì—…ì€ ì™„ë£Œí•˜ì§€ ì•Šì•„ì„œ  
`moneyminder-common` ëª¨ë“ˆì— ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë©€í‹°ëª¨ë“ˆì„ êµ¬ì„±í–ˆìŒ


<br>


## âœ… ë§ˆì¹˜ë©°
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê¸°ì¡´ ë‹¨ì¼ ëª¨ë“ˆ í”„ë¡œì íŠ¸ë¥¼ ë©€í‹° ëª¨ë“ˆë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.  
ë©€í‹° ëª¨ë“ˆ êµ¬ì„±ì€ ì²˜ìŒ í•´ë´¤ëŠ”ë°, ìƒê°ë³´ë‹¤ ë³µì¡í•œ ë¶€ë¶„ë“¤ì´ ë§ì•˜ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” `Api Gateway`ì™€ `Discovery Server`, `Config-service` ë¥¼ ì¶”ê°€í•´ë³´ê² ìŠµë‹ˆë‹¤.



