---
title: @Component + @MockBean ì‚¬ìš©ì‹œ ì£¼ì˜ì‚¬í•­
date: 2024-07-30 10:30:00 +09:00
categories: [Trouble Shooting]
tags:
  [
    java,
    Spring,
    ìŠ¤í”„ë§,
    í…ŒìŠ¤íŠ¸,
    ì—ëŸ¬í•´ê²°,
    MockBean
  ]
---

* * *

> ê°œë°œí•˜ë˜ ì¤‘ ê°‘ìê¸° íŠ¹ì • ë„ë©”ì¸ì˜ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë¶ˆí†µì´ ëë‹¤ (Service + Controller ê³„ì¸µ)  
> ì‹¤ì œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  APIì„ í˜¸ì¶œí•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µì´ ë˜ëŠ”ë° í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ëŒë¦´ë•Œë§Œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤....   
> ë””ë²„ê¹…í•˜ê³  í™•ì¸í•´ë³´ë‹ˆ `@Component` + `@MockBean` ì‚¬ìš©ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œì˜€ë‹¤...

ì›ì¸ ë¶„ì„ê³¼ í•´ê²° ê³¼ì •ì„ ì •ë¦¬ í•´ë³´ì.


## âœ… ì›ì¸ ë¶„ì„ ê³¼ì •

### ì½”ë“œ ì„¤ëª…

```java
// í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¤‘ í•œ ê°œ
@DisplayName("ìƒì„± - ì„±ê³µì ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•œë‹¤")
@Test
void whenCreateCategory_thenCategoryIsCreated() {
  // given
  CategoryServiceCreateReq request = CategoryServiceCreateReq.builder()
    .categoryName("ì¹´í…Œê³ ë¦¬")
    .categoryType(CategoryType.EXPENSE)
    .description("ì¹´í…Œê³ ë¦¬ ì„¤ëª…")
    .userEmail("ì´ë©”ì¼")
    .build();

  // when
  CategoryServiceRes createdCategory = categoryService.create(request);
  Category fetchedCategory = categoryRepository.findById(createdCategory.id()).get();

  // then
  assertThat(fetchedCategory.categoryName()).isEqualTo("ì¹´í…Œê³ ë¦¬");
  assertThat(fetchedCategory.categoryType()).isEqualTo(CategoryType.EXPENSE);
  assertThat(fetchedCategory.description()).isEqualTo("ì¹´í…Œê³ ë¦¬ ì„¤ëª…");
  assertThat(fetchedCategory.isCustom()).isTrue();
}

// Service ì½”ë“œ
@Transactional
public CategoryServiceRes create(CategoryServiceCreateReq request) {
  Category category = categoryRepository.save(Category.create(request));
  return CategoryServiceRes.fromDomain(category);
}

// Repository ì½”ë“œ
@Override
public Category save(Category category) {
  return jpaRepository.save(category.toEntity()).toDomain();
}
```
Repositoryì™€ JpaRepositoryê°€ ë¶„ë¦¬ë˜ì–´ ìˆëŠ” êµ¬ì¡°ë¼ ì¢€ í–‡ê°ˆë¦´ìˆ˜ë„ ìˆë‹¤.

### ğŸ“Œ ë¡œê·¸í™•ì¸
ë¡œê·¸ë¥¼ í™•ì¸í•´ë´ë„ NPEë§Œ í„°ì§€ê³  ë³„ë‹¤ë¥¸ íŠ¹ì´ì‚¬í•­ì„ í™•ì¸í•  ìˆ˜ ì—†ì—ˆë‹¤.  
CategoryRepositoryë¥¼ í™•ì¸í•´ë´ë„ Beanì´ êµ¬í˜„ì²´ë¡œ ì •ìƒì ìœ¼ë¡œ ì‚½ì…ëœ ìƒíƒœì˜€ë‹¤.... 
<br>

### ğŸ“Œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë””ë²„ê¹…
í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë””ë²„ê¹…í•´ë³´ë‹ˆ `CategoryRepository`ì˜ `save` ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ì§€ ì•Šê³  `null`ì´ ë°˜í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.  
<br>

### ğŸ“Œ ì›ì¸ ë¶„ì„
ë‹¤ë¥¸í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì»´í¬ë„ŒíŠ¸ë¡œ ë“±ë¡í•˜ê³  `@MockBean`ìœ¼ë¡œ Mockingëœ Beanì„ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤.  
`@Component` + `@MockBean` ì‚¬ìš©ì‹œ Mockingëœ Beanì´ ì£¼ì…ë˜ì–´ ì‹¤ì œ Beanì´ ì£¼ì…ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

```java
@Component
public class AccountTestHelper {

  @Autowired
  private AuthHelper authHelper;

  @MockBean
  private CategoryRepository categoryRepository;
}
```

![img.png](../../assets/img/TroubleShooting/MOCK-BEAN.png)

<br>

##  âœ… í•´ê²°

### ğŸ“Œ@SpyBean ì ìš©
SpyBeanì€ Stubbingì„ ì§€ì •í•´ì£¼ë©´ í•´ë‹¹ Sutbbing ìœ¼ë¡œ ë™ì‘í•˜ê³  ì•„ë‹ˆë©´ ì‹¤ì œ Beanì²˜ëŸ¼ ë™ì‘í•œë‹¤.

<br><br>

### ë§ˆì¹˜ë©°
* `@Component` + `@MockBean` ì‚¬ìš©ì‹œ Mockingëœ Beanì´ ì£¼ì…ë˜ì–´ ì‹¤ì œ Beanì´ ì£¼ì…ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
* ê¸°ìˆ ì€ ì—­ì‹œ ì˜ ì•Œê³  ì¨ì•¼í•œë‹¤. í…ŒìŠ¤íŠ¸ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì €ë ‡ê²Œ ë™ì‘í•˜ì—¬ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ë°œìƒí•  ì¤„ ëª°ëë‹¤.. -.-






